{% extends "shop/base.html" %}
{% load i18n %}
{% load widget_tweaks %}
{% load static %}

{% block title %}Pay by credit card{% endblock %}

{% block content %}
{% include 'cart/detail_header.html' %}

<div id="wrapper">
  <!-- content -->	
  <div class="content">
      <!-- column-image  -->	
      <div class="column-image">
          <div class="bg"  data-bg="images/bg/1.jpg"></div>
          <div class="overlay"></div>
          <div class="column-title">
              <h2>Contact Info</h2>
              <h3>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas in pulvinar neque. Nulla finibus lobortis pulvinar.</h3>
          </div>
          <div class="column-notifer">
              <div class="scroll-down-wrap transparent_sdw">
                  <div class="mousey">
                      <div class="scroller"></div>
                  </div>
                  <span>Scroll down  to Discover</span>
              </div>
          </div>
          <div class="fixed-column-dec"></div>
      </div>
      <!-- column-image end  -->	
      <!-- column-wrapper -->	
      <div class="column-wrapper ">
<!--scroll-nav-wrap -->	
          <div class="scroll-nav-wrap">
              <nav class="scroll-nav scroll-init">
                  <ul>
                      <li><a class="act-scrlink" href="#sec1">Details</a></li>
                      <li><a href="#sec2">Location</a></li>
                      <li><a href="#sec3">Say Hello</a></li>
                  </ul>
              </nav>
          </div>
							
          <section id="sec3">
              <div class="container small-container">
                  <div class="section-title fl-wrap">
                      <h3>Make your reservations</h3>
                      <div class="contact-details fl-wrap">
                        {% for item in cart %}
                        <ul>
                          <li><span>Tour :</span>{{ item.product.name }} </li>
                            <li><span># <i class="fal fa-user"></i>:</span>{{ item.quantity }}</li>
                            <li><span>Sub total :</span>${{ item.total_price|floatformat:"2" }}</li>
                            <li><span>Discount :</span>
                              {% blocktrans with code=cart.coupon.code discount=cart.coupon.discount %}
                                {{ code }} ({{ discount }}% off)
                              {% endblocktrans %}
                              <span>- ${{ cart.get_discount|floatformat:"2" }}</span>
                            </li>
                            <p>{% trans "Total" %}: ${{ cart.get_total_price_after_discount|floatformat:"2" }}</p>
                        </ul>
                        {% endfor %}
                    </div>   
                  </div>
                  <div class="column-wrapper_item fl-wrap">
                      <div class="column-wrapper_text fl-wrap">
                          <div id="contact-form" class="fl-wrap">
                              <div id="message"></div>
                            
                              <div class="container">
                                <div class="container-wrap per">
                                  
                                  <div class="form-controls__steps">1/4</div>
                              
                                  <nav class="form-controls">
                                    <a href="" class="form-controls__prev form-controls--hidden">
                                      <svg width="19" height="32" viewBox="0 0 19 32" xmlns="http://www.w3.org/2000/svg"><title>next</title><path fill="#ffffff" d="M5.657 15.556L18.385 2.828 15.555 0 0 15.556l15.556 15.557 2.83-2.83" fill-rule="evenodd"/></svg>
                                    </a>
                                    <a href="" class="form-controls__next form-controls--hidden">
                                      <svg width="19" height="32" viewBox="0 0 19 32" xmlns="http://www.w3.org/2000/svg"><title>prev</title><path fill="#ffffff" d="M12.727 15.556L0 2.828 2.828 0l15.557 15.556L2.828 31.113 0 28.283" fill-rule="evenodd"/></svg>
                                    </a>
                                  </nav>
                              
                                  <form action="/" method="post" id="cardForm">
                                    <div class="field-container">
                                      <label class="hosted-field--label " for="card-number">Card Number
                                      </label>
                                      <div class="hosted-field" id="card-number"></div>
                                    </div>
                              
                                    <div class="field-container field-container--hidden">
                                      <label class="hosted-field--label " for="expiration-date">
                                        Exp (MM/YY)
                                      </label>
                                      <div class="hosted-field" id="expiration-date"></div>
                                    </div>
                              
                                    <div class="field-container field-container--hidden">
                                      <label class="hosted-field--label " for="cvv">
                                      CVV
                                    </label>
                                      <div class="hosted-field" id="cvv"></div>
                                    </div>
                              
                                    <div class="field-container field-container--hidden field-container--button">
                                      <input id="button-pay" type="submit" value="Pay" />
                                    </div>
                                  </form>
                              
                                  <div class="form-info">
                                    <p class="field-message">Let's add your card number.</p>
                                  </div>
                                  
                                </div>
                              </div>
                              
                              
                                
                            
                          </div>
                      </div>
                  </div>
              </div>
          </section>
          <!--section end  -->	
          <!--footer -->			
          <footer class="min-footer fl-wrap content-animvisible">
              <div class="container small-container">
                  <div class="footer-inner fl-wrap">
                      <!-- policy-box-->
                      <div class="policy-box">
                          <span>&#169; Kotlis 2019  /  All rights reserved. </span>
                      </div>
                      <!-- policy-box end-->
                      <a href="#" class="to-top-btn to-top">Back to top <i class="fal fa-long-arrow-up"></i></a>
                  </div>
              </div>
          </footer>
          <!--footer end  -->	
      </div>
      <!-- column-wrapper -->	
  </div>
  <!--content end-->	
  <!--share-wrapper-->
  <div class="share-wrapper">
      <div class="share-container fl-wrap  isShare"></div>
  </div>
  <!--share-wrapper end-->
</div>
  
  <!-- Load the required client component. -->
  <script src="https://js.braintreegateway.com/web/3.29.0/js/client.min.js"></script>
  <!-- Load Hosted Fields component. -->
  <script src="https://js.braintreegateway.com/web/3.29.0/js/hosted-fields.min.js"></script>
  <script>
    var form = document.querySelector('#payment');
    var submit = document.querySelector('input[type="submit"]');

    braintree.client.create({
      authorization: '{{ client_token }}'
    }, function (clientErr, clientInstance) {
      if (clientErr) {
        console.error(clientErr);
        return;
      }

      braintree.hostedFields.create({
        client: clientInstance,
        styles: {
          'input': {'font-size': '13px'},
          'input.invalid': {'color': 'red'},
          'input.valid': {'color': 'green'}
        },
        fields: {
          number: {selector: '#card-number'},
          cvv: {selector: '#cvv'},
          expirationDate: {selector: '#expiration-date'}
        }
      }, function (hostedFieldsErr, hostedFieldsInstance) {
        if (hostedFieldsErr) {
          console.error(hostedFieldsErr);
          return;
        }

        submit.removeAttribute('disabled');

        form.addEventListener('submit', function (event) {
          event.preventDefault();

          hostedFieldsInstance.tokenize(function (tokenizeErr, payload) {
            if (tokenizeErr) {
              console.error(tokenizeErr);
              return;
            }
            // set nonce to send to the server
            document.getElementById('nonce').value = payload.nonce;
            // submit form
            document.getElementById('payment').submit();
          });
        }, false);
      });
    });
  </script>
{% endblock %}